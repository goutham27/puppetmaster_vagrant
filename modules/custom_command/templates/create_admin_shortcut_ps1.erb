$shortcut_basename = '<%=@shortcut_basename -%>'
$shortcut_pathname = "<%=@shortcut_pathname -%>"
$shortcut_path = ('{0}\{1}.lnk' -f $shortcut_pathname, $shortcut_basename  )
$shortcut_targetpath = 'c:\Program Files\Puppet Labs\Puppet\bin\facter.bat'
$shortcut_target_arguments = '--json'
$shortcut_run_as_admin = 'true' # pass 'true' argument as string
$o = new-object -ComObject 'WScript.Shell'
$s = $o.CreateShortcut($shortcut_path)
$s.TargetPath = $shortcut_targetpath 
$s.Arguments = $shortcut_target_arguments
write-output 'Save shortcut'
$s.Save()
if ( -not ($shortcut_run_as_admin -match 'true')) { exit 0}
write-output 'Setting admin bit'
$bytes = [System.IO.File]::ReadAllBytes($shortcut_path) 
$bytes[0x15] = $bytes[0x15] -bor 0x20 # set byte 21 (0x15) bit 6 (0x20) ON
[System.IO.File]::WriteAllBytes( $shortcut_targetpath, $bytes)
write-output 'Done.'
exit 0 

